{% extends "Admin/Dashboard/dashboardLayout.html" %}
{% block content %}

<script src="{{url_for('static',filename='js/jquery-ui/jquery-ui.min.js')}}"></script>
<link rel="stylesheet" href="{{  url_for('static',filename='js/jquery-ui/jquery-ui.min.css') }}">

<div class="page-wrapper">
        <!-- ============================================================== -->
        <!-- Bread crumb and right sidebar toggle -->
        <!-- ============================================================== -->
        <div class="page-breadcrumb">
            <div class="row">
                <div class="col-12 d-flex no-block align-items-center">
                    <h4 class="page-title">Edit Post</h4>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- End Bread crumb and right sidebar toggle -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Container fluid  -->
        <!-- ============================================================== -->
        <div class="container-fluid col-md-5 col-lg-6">
           
               <!-- Search form -->
        <form class="form-inline col-md-6 form-sm active-cyan-2 mt-2">
            <input class="form-control form-control-sm mr-3 w-75" type="text" placeholder="Search "
              aria-label="Search" style="border-color: black">
            <i class="fas fa-search" aria-hidden="true"></i>
          </form>
    

                <form>
                        <div class="form-group mt-4">
                          <label > Job Tillte<span style="color: red">*</span></label>
                          <input type="text" class="form-control" style="border-color: black" required="" >
                      </div>
            
                      <div class="form-group">
                            <label for="exampleFormControlInput1">Department</label>
                    <select class="custom-select custom-select-sm "style="border-color: black">
                        <option selected>Select</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                      </select>
                    </div>
              
                      <div class="form-group">
                          <label>Job Advertistment</label>
                          <input type="file" class="form-control-file" id="exampleFormControlFile1" style="border-color: black">
                      </div>
              
                      <div class="row">
                            <div class="col-md-2">
                            <button type="button" class="btn btn-warning mt-2">UPDATE</button>
                            </div>
                            <div class="col-md-2">
                                    <button type="button" class="btn btn-danger mt-2">DELETE</button>
                                    </div>
            
                        </div>
              
                  </form>
              
         

      <div class="form-group">
        <label>Job Advertistment</label>
        <input type="file" class="form-control-file" id="FileFieldJobAdvertistment" name="FileFieldJobAdvertistment"
          style="border-color: black">
      </div>

      <div class="row">
        <div class="col-md-2">
          <button type="submit" class="btn btn-warning mt-2">UPDATE</button>
        </div>
        <div class="col-md-2">
          <button type="button" id="ButtonDelete" class="btn btn-danger mt-2">DELETE</button>
        </div>

      </div>

    </form>



  </div>

  <script>

    $(document).ready(function () {
      LoadDropDown();

      $("#TextBoxSearch").autocomplete({
        source: function (request, response) {
          $.ajax({
            url: '/Vacancy/AutoComplete/' + $('#TextBoxSearch').val(),
            type: 'post',
            success: function (data) {
              SourceData = [];
              $.each(data, function (index, value) {
                SourceData.push(value['Title']);
              });
              response(SourceData);
            },
            error: function (xhr, errorThrown) {
              console.log(xhr, errorThrown);
            }
          });
        },
        select: function (e, ui) {
          $.ajax({
            url: '/SetVacancyAutocompleteSelected/' + ui.item.label,
            type: 'post',
            success: function (data) {
              console.log(data);
              if (data.Message === "Success") {
                $('#TextBoxItemId').val(data.ItemID);
                $('#JobTitle').val(data.Title);
                $("#DropDownListDepartment").prop('selectedIndex', data.DepartmentIndex);
              }
              else {
                alertify.error(data.Message);
              }
            },
            error: function (xhr, errorThrown) {
              console.log(xhr, errorThrown);
            }
          });
        },
      });

    });


    $('#UpdateVacancyForm').submit(function (e) {
      e.preventDefault();
      var formData = new FormData(this);
      $.ajax({
        type: 'post',
        data: formData,
        url: '/Edit_Vacancy',
        success: function (data) {
          if (data.Type == "Success") {
            $("form").trigger("reset");
            alertify.success(data.Message);
          }
          else {
            alertify.error(data.Message);
          }
        },
        error: function (xhr, errorThrown) {
          console.log(xhr, errorThrown);
        },
        cache: false,
        contentType: false,
        processData: false
      });
    });

    function LoadDropDown() {
      $.ajax({
        type: 'get',
        url: '/GetDepartments',
        success: function (data) {
          var options = '';
          for (var x = 0; x < data.length; x++) {
            options += '<option value="' + data[x]['id'] + '">' + data[x]['ItemName'] + '</option>';
          }
          $('#DropDownListDepartment').html(options);
        },
        error: function (xhr, errorThrown) {
          console.log(xhr, errorThrown);
        }
      });
    }


    $('#ButtonDelete').click(function (e) {
      var Param = $('#TextBoxItemId').val();
      if (Param == "") {
        alertify.error("Please search and select the product!");
        return;
      }
      $.ajax({
        url: '/DeleteVacancy/' + Param,
        type: 'post',
        success: function (data) {
          if (data.Type == "Success") {
            alertify.success(data.Message);
            ClearAll();
            return;
          }
          alertify.error(data.Message);
        },
        error: function (xhr, errorThrown) {
          console.log(xhr, errorThrown);
        }
      });
    });

    function ClearAll() {
      $("#TextBoxSearch").val("");
      $('#TextBoxItemId').val("");
      $('#JobTitle').val("");
      $("#DropDownListDepartment").prop('selectedIndex', 0);
      $('#FileFieldJobAdvertistment').val("");
    }

  </script>


  {% endblock content %}